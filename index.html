<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Application plan — Navigation intérieure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b5fff" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="assets/icons/icon-180.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="stylesheet" href="css/style.css" />

  <style>
    /* DEBUG plan image */
    #plan-image {
      min-height: 70vh;
      height: calc(100vh - 180px);
      display: block;
      background-color: #fff;
      outline: 1px dashed #aaa;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: top left;
    }
    #plan-container, #viewport { min-height: 70vh; }
  </style>
</head>

<body>
  <header>
    <h1>Navigation intérieure — bâtiment</h1>
    <div class="toolbar">
      <span id="modeBadge" class="mode-badge">Mode utilisation</span>

      <!-- ✔️ Bouton unique -->
      <button id="editModeBtn">Mode ÉDITION</button>

      <div class="hint">
        Ouvrez ce fichier dans Firefox. Import auto de <code>data/plan_graph.json</code>.
      </div>
    </div>
  </header>

  <div class="app">
    <aside class="sidebar">

      <div class="card" id="route-panel">
        <h2>Itinéraire</h2>
        <div class="row">
          <label>Départ :</label>
          <select id="startSelect"></select>
        </div>
        <div class="row">
          <label>Arrivée :</label>
          <select id="endSelect"></select>
        </div>
        <div class="row">
          <button id="computeRoute">Calculer l’itinéraire</button>
        </div>
        <div id="routeDistance">Distance totale : —</div>
        <ol id="routeSteps"></ol>
      </div>

      <!-- ✔️ Bloc Échelle (tout masqué en utilisation) -->
      <div class="card edit-button" id="scale-panel">
        <h2>Échelle (distances réelles)</h2>

        <div class="hint edit-button">
          Sélectionnez 2 points, entrez la distance, puis "Définir l’échelle".
        </div>

        <div class="row edit-button">
          <input id="scaleDistance" type="number" min="0" step="0.01" placeholder="distance en mètres">
          <button id="defineScaleBtn" class="edit-button">Définir l’échelle</button>
        </div>

        <div id="scaleLabel" class="edit-button">Échelle : —</div>
      </div>

      <!-- ✔️ Bloc édition -->
      <div class="card edit-button" id="mode-panel">
        <h2>Édition</h2>

        <div class="hint edit-button">
          Ces actions sont actives uniquement en mode <b>Édition</b>.
        </div>

        <div class="row edit-button">
          <input id="poiName" type="text" placeholder="Nom du point">
	<button id="deleteSelectedPoint" class="edit-button">Supprimer ce point</button>
          <button id="deleteLastPoint" class="edit-button">Supprimer dernier point</button>
        </div>

        <div class="row edit-button">
          <button id="toggleEdgeMode" class="edit-button">Mode couloir</button>
          <button id="toggleDeleteEdgeMode" class="edit-button">Suppression couloir</button>
          <button id="deleteLastEdge" class="edit-button">Supprimer dernier couloir</button>
          <button id="clearAllEdges" class="danger edit-button">Supprimer tous les couloirs</button>
        </div>

        <div class="row edit-button">
          <button id="exportJson" class="edit-button">Exporter JSON</button>

          <!-- input non masqué sinon on ne peut rien importer -->
          <input id="importFile" type="file" accept=".json">

          <button id="importBtn" class="edit-button">Importer</button>
        </div>
      </div>

    </aside>

    <main class="stage-wrap">
      <div class="stage">
        <div id="plan-container">
          <div id="viewport">
            <div class="zoom-ui">
              <button id="zoomInBtn" title="Zoom avant (+)">+</button>
              <button id="zoomOutBtn" title="Zoom arrière (−)">−</button>
              <button id="zoomResetBtn" title="Réinitialiser (0)">⟲</button>
              <div class="label" id="zoomLabel">100%</div>
            </div>

            <div id="camera">
              <div id="plan-image"></div>
              <svg id="scene">
                <g id="edges-layer"></g>
                <g id="path-layer"></g>
                <g id="points-layer"></g>
                <line id="edge-highlight" class="edge-hover" style="display:none;" x1="0" y1="0" x2="0" y2="0"></line>
              </svg>
            </div>

          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/app.js"></script>

</body>
</html>